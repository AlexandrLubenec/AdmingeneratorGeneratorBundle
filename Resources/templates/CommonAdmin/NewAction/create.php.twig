{% use '../CommonAdmin/security_action.php.twig' %}
{% block create_use %}
{% endblock %}
{% block create %}

    public function createAction()
    {
        {{ block('security_action') }}

        ${{ builder.ModelClass }} = $this->getNewObject();

        $type = new NewType();
        $type->setSecurityContext($this->get('security.context'));
        $form = $this->createForm($type, ${{ builder.ModelClass }});
        $form->bindRequest($this->get('request'));

        if ($form->isValid()) {
            $this->saveObject(${{ builder.ModelClass }});

            $this->get('session')->setFlash('success', {% if messages.success is defined %} "{{ messages.success }}" {% else %} $this->get('translator')->trans('object.saved.success', array(), 'Admingenerator') {% endif %} );

            return new RedirectResponse($this->generateUrl("{{ builder.routePrefixWithSubfolder }}_{{ bundle_name }}{{ builder.BaseGeneratorName ? "_" ~ builder.BaseGeneratorName : "" }}_edit", array('id' => ${{ builder.ModelClass }}->getId()) ));

        } else {
            $this->get('session')->setFlash('error', {% if messages.error is defined %} "{{ messages.error }}" {% else %} $this->get('translator')->trans('object.saved.error', array(), 'Admingenerator') {% endif %} );
        }

        return $this->render('{{ namespace_prefix }}{{ bundle_name }}:{{ builder.BaseGeneratorName }}New:index.html.twig', array(
            "{{ builder.ModelClass }}" => ${{ builder.ModelClass }},
            "form" => $form->createView(),
        ));
    }
{% endblock %}
