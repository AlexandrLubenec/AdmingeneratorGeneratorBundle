{% block list_batch_actions %}
    {{ echo_block("list_batch_actions") }}
        {% if batch_actions is defined and batch_actions|length > 0 %}
        <div class="control-group form-horizontal">
            <label class="control-label" for="batchActionSelector">{{ echo_trans('batch.list.selector') }}</label>
            <div class="controls">
                <select id="batchActionSelector" name="action">
                    <option value="none">{{ echo_trans('batch.list.selected') }}</option>
                    {% for action in builder.BatchActions %}
                        {% if action.credentials or builder.generator.getFromYaml('builders.' ~ action.name ~ '.params.credentials') %}
                            {{ echo_if_granted( action.credentials ? action.credentials : builder.generator.getFromYaml('builders.' ~ action.name ~ '.params.credentials')) }}
                        {% endif %}
                        <option
                            value="{{ action.name }}"
                            {%- if action.confirm %} data-confirm='{{ echo_trans(action.confirm) }}' {% endif -%}
                        >
                              {% if action.icon %}<i class="{{ action.icon }}"></i> {% endif %}{{ echo_trans(action.label) }}
                        </option>
                        {% if action.credentials or builder.generator.getFromYaml('builders.' ~ action.name ~ '.params.credentials') %}
                            {{ echo_endif () }}
                        {% endif %}
                    {% endfor %}
                </select>
                <button type="submit" name="batch" class="btn">{{ echo_trans('batch.list.send') }}</button>
            </div>
        </div>
        <script type="text/javascript">
            (function(window, $, undefined){
                $(function() {
                    var submitActionner = $('button[name=batch]');
                    submitActionner.hide();
                    $("select[name=action]").on('change', function(e) {
                        if ($(this).val()=='none') {
                            return false;
                        }

                        if ($('input.batch_select_id:checked').length == 0) {
                            alert('{{ echo_trans("batch.list.none.selected") }}');
                            $(this).val('none');
                            return false;
                        }

                        if ($(this).data('confirm') && !confirm($(this).data('confirm'))) {
                        	$(this).val('none');
                            return;
                        }

                        submitActionner.click();
                    });
                });
            })(window, jQuery);
        </script>
        {% endif -%}
    {{ echo_endblock() }}
{% endblock %}

{% block form_batch_actions %}
    {{ echo_block("form_batch_actions") }}
    {% if batch_actions is defined and batch_actions|length > 0 %}
        {% set actionPathName = builder.routePrefixWithSubfolder ~ '_' ~ bundle_name ~ ( builder.BaseGeneratorName ? "_" ~ builder.BaseGeneratorName : "" ) ~ '_batch' %}
        <form method="post" action="{{ echo_path(actionPathName) }}">
            <input type="hidden" value="{{ echo_twig_filter(actionPathName, 'csrf_token', true) }}" name="_csrf_token" />
    {% endif %}
    {{ echo_endblock() }}
{% endblock %}

{% block endform_batch_actions %}
    {{ echo_block("endform_batch_actions") }}
    {% if batch_actions is defined and batch_actions|length > 0 %}
        </form>
    {% endif %}
    {{ echo_endblock() }}
{% endblock %}
